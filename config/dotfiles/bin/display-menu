#!/usr/bin/env bash

PRIMARY="eDP-1"
SECONDARY="HDMI-1"

# Проверка подключения
xrandr --query | grep -q "^$PRIMARY connected" || { notify-send "Ошибка" "$PRIMARY не подключён"; exit 1; }
xrandr --query | grep -q "^$SECONDARY connected" || { notify-send "Ошибка" "$SECONDARY не подключён"; exit 1; }

# Меню
CHOICE=$(printf "Дублировать\nРасширить — слева\nРасширить — справа\nРасширить — сверху\nРасширить — снизу\nТолько $PRIMARY\nТолько $SECONDARY" | rofi -dmenu -i -p "Экраны:")

# --- ВАЖНО: всегда сначала "сбрасываем" оба экрана в команде ---
case "$CHOICE" in
    "Дублировать")
        xrandr --output eDP-1 --auto --primary --output HDMI-1 --same-as eDP-1
        bspc monitor eDP-1 -d 1 2 3 4 5 6 7 8 9
        bspc monitor HDMI-1 -r
        bspc wm -O eDP-1 HDMI-1
        ;;
    "Расширить — слева")
        xrandr --output HDMI-1 --mode 1920x1080 --left-of eDP-1 --pos 1920x1080 \
               --output eDP-1 --auto --primary
        sleep 1
        bspc monitor eDP-1 -d 1 2 3 4 5
        bspc monitor HDMI-1 -d 6 7 8 9
        bspc wm -O eDP-1 HDMI-1

        ;;
    "Расширить — справа")
        xrandr --output eDP-1 --auto --primary \
               --output HDMI-1 --mode 1920x1080 --right-of eDP-1 --pos 1920x1080
        sleep 1
        bspc monitor eDP-1 -d 1 2 3 4 5
        bspc monitor HDMI-1 -d 6 7 8 9
        bspc wm -O eDP-1 HDMI-1

        ;;
    "Расширить — сверху")
        xrandr --output HDMI-1 --mode 1920x1080 --above eDP-1 --pos 1920x1080 \
               --output eDP-1 --auto --primary
        sleep 1
        bspc monitor eDP-1 -d 1 2 3 4 5
        bspc monitor HDMI-1 -d 6 7 8 9
        bspc wm -O eDP-1 HDMI-1

        ;;
    "Расширить — снизу")
        xrandr --output eDP-1 --auto --primary \
               --output HDMI-1 --mode 1920x1080 --below eDP-1 --pos 1920x1080
        sleep 1
        bspc monitor eDP-1 -d 1 2 3 4 5
        bspc monitor HDMI-1 -d 6 7 8 9
        bspc wm -O eDP-1 HDMI-1
        ;;
    "Только eDP-1")
        xrandr --output eDP-1 --auto --primary --output HDMI-1 --off
        sleep 1
        bspc monitor eDP-1 -d 1 2 3 4 5 6 7 8 9
        bspc monitor HDMI-1 -r
        ;;
    "Только HDMI-1")
        xrandr --output HDMI-1 --auto --primary --output eDP-1 --off
        sleep 1
        bspc monitor HDMI-1 -d 1 2 3 4 5 6 7 8 9
        bspc monitor eDP-1 -r
        ;;
    *)
        exit 0
        ;;
esac

notify-send "Экраны" "Выбрано: $CHOICE"
sh ~/.config/dotfiles/bin/random_wall.sh
